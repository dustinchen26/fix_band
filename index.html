<!-- 
  Copyright © [2023] [Dustin_Chen]. All rights reserved.
  Author: Dustin_Chen
  Email:  Dustin_Chen@compal.com or chuhpsdustin@gmail.com
-->  
<!DOCTYPE html>
<html>
<head>
    <title>Qcom fix band NV setting</title>
</head>
<style>
    /* 去除表格邊框線 */
    table {
        border-collapse: collapse;
    }
    table, th, td {
        border: 0;
    }

    /* 將表格內容置中對齊 */
    table td {
        text-align: center;
    }
	
    /* 设置行间距为零 */
    p {
        margin: 0;
        padding: 0;
        line-height: 1.5; /* 调整行高，可以根据需要修改值 */
    }

    /* 按下按钮后的激活样式 */
    .button.active {
        background-color: yellow; /* 或其他你希望的颜色 */
        color: black; /* 或其他适合的颜色 */
    }
</style>
<body>
    <h1>Qcom fix band NV setting</h1>
    <p style="margin: 0;">Author: Dustin_Chen, email: <a href="mailto:Dustin_Chen@compal.com" style="line-height: 1;">Dustin_Chen@compal.com</a> or <a href="mailto:chuhpsdustin@gmail.com" style="line-height: 1;">chuhpsdustin@gmail.com</a></p>
    <p>【操作說明】 Qcom fix mode_pref NR_only & fix NR band NV setting</p>    
    <p>● fix NR only => NV#80000 設 64，NV#10 設 71</p>
    <p>● fix NR band => NV#74087 NR band preference</p>
    <p>&nbsp &nbsp 要fix哪些NR band，將底下64個按鈕分別對應不同band，按下變成黃色，bit設為1，用10進位填入</p>
    <p>&nbsp &nbsp band 1~64 => 填入到 bits_1_64 欄位</p>
    <p>&nbsp &nbsp band 65~128 => 填入到 bits_65_128 欄位</p>
    <p>&nbsp &nbsp band 129~192 => 填入到 bits_129_192 欄位</p>
    <p>&nbsp &nbsp band 193~256 => 填入到 bits_193_256 欄位</p>
    <p>&nbsp &nbsp band 257~320 => 填入到 bits_257_320 欄位</p>
    <p>&nbsp &nbsp &nbsp ex: fix N41 底下按鈕 41 的bit舉為1 => 計算出 1099511627776 , 填到 bits_1_64</p>
    <p>&nbsp &nbsp &nbsp ex: fix N48 底下按鈕 48 的bit舉為1 => 計算出 140737488355328 , 填到 bits_1_64</p>
    <p>&nbsp &nbsp &nbsp ex: fix N78 =>(78-64=14)底下按鈕 14 的bit舉為1 => 計算出 8192 , 填到 bits_65_128</p>
    <p>&nbsp &nbsp &nbsp ex: fix N79 =>(79-64=15)底下按鈕 15 的bit舉為1 => 計算出 16384 , 填到 bits_65_128</p>
    <br>
    <!-- 新增的表格 -->
    <table>
        <tr>
            <!-- 使用 JavaScript 動態生成按鈕 -->
            <script>
                for (let i = 64; i >= 1; i--) {
                    document.write(`
                        <td><button id="button${i}" class="button" value="0" onclick="toggleValue(${i})">0</button></td>
                    `);
                }
            </script>
        </tr>
        <tr>
            <!-- 使用 JavaScript 動態生成表格內容 -->
            <script>
                for (let i = 64; i >= 1; i--) {
                    document.write(`
                        <td>${i}</td>
                    `);
                }
            </script>
        </tr>
    </table>

    <!-- 輸入數字的標籤與輸入框 -->
    <br>
    <label for="number" id="numberLabel">輸入數字：</label>
    <input type="text" id="number" oninput="handleNumberChange()">
    
    <!-- 顯示十六進位、十進位、二進位結果的區域 -->
    <p>十六進位：<span id="hexResult"></span></p>
    <p>十進位●：<span id="decimalResult"></span></p>
    <p>二進位：<span id="binaryResult"></span></p>

    <script>
        const buttons = document.querySelectorAll(".button");

        buttons.forEach(button => {
            const buttonValue = button.value;
            if (buttonValue === "1") {
                button.classList.add("active");
            }

            button.addEventListener("click", () => {
                button.classList.toggle("active");
            });
        });

        // 轉換函數，當按下轉換按鈕時觸發
        function convert() {
            const hexResultElement = document.getElementById("hexResult");
            const decimalResultElement = document.getElementById("decimalResult");
            const binaryResultElement = document.getElementById("binaryResult");

            try {
                // 更新二進位數字
                updateBinaryNumber();

                // 若有輸入數字，則執行原始的轉換函數
                if (document.getElementById("number").value) {
                    // 將輸入數字轉換為十進位數字
                    const binaryInput = getBinaryInput();
                    const decimal = customParseInt(binaryInput, 2n); // Use BigInt

                    // 將十進位數字轉換為指定進位制數字
                    const hex = customDecimalToBase(decimal, 16n).toUpperCase(); // Use BigInt
                    const binary = customDecimalToBase(decimal, 2n); // Use BigInt

                    // 更新顯示的結果
                    hexResultElement.textContent = hex;
                    decimalResultElement.textContent = decimal.toString(); // Convert BigInt to string
                    binaryResultElement.textContent = binary;
                }
            } catch (error) {
                // 若發生錯誤，顯示錯誤訊息
                alert("請輸入有效的數字。");
            }
        }

        // 新增的按鈕切換函數
        function toggleValue(buttonIndex) {
            const buttonElement = document.getElementById(`button${buttonIndex}`);
            const newValue = buttonElement.value === "0" ? "1" : "0";
            buttonElement.value = BigInt(newValue);
            buttonElement.textContent = newValue;

            // 觸發轉換函數
            convert();
        }

        // 更新二進位數字的函數
        function updateBinaryNumber() {
            let binaryNumber = "";
            for (let i = 64; i >= 1; i--) {
                const bitValue = document.getElementById(`button${i}`).value;
                binaryNumber += bitValue;
            }

            document.getElementById("number").value = "BIN " + binaryNumber;
        }

        // 取得二進位輸入的函數
        function getBinaryInput() {
            let binaryInput = "";
            for (let i = 64; i >= 1; i--) {
                const bitValue = document.getElementById(`button${i}`).value;
                binaryInput += bitValue;
            }

            return binaryInput;
        }

        // 自訂的十進位轉換為其他進位制的函數
        function customDecimalToBase(decimal, base) {
            const digitMap = "0123456789ABCDEF";
            let result = "";

            while (decimal > 0n) {
                result = digitMap[Number(decimal % base)] + result;
                decimal = decimal / base;
            }

            return result || "0";
        }

        // 自訂的 parseInt 函數，用於將不同進位制的數字轉換為十進位
        function customParseInt(number, base) {
            const digitMap = "0123456789ABCDEF";
            let result = 0n;
            const numString = number.toUpperCase();

            let startIndex = 0;
            let isNegative = false;
            if (numString.startsWith("BIN")) {
                isNegative = numString[4] === "1";
                startIndex = 4;
            }

            for (let i = startIndex; i < numString.length; i++) {
                let digit;
                if (numString[i] === '0' || numString[i] === '1') {
                    digit = BigInt(numString[i]);
                } else {
                    digit = BigInt(digitMap.indexOf(numString[i]));
                }
                
                if (digit === -1n || digit >= base) {
                    throw new Error("Invalid digit in number");
                }
                result = result * base + digit;
            }

            if (isNegative) {
                result = -result;
            }

            return result;
        }
    </script>
</body>
</html>
